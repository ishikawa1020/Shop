import{a as ze,P as ve,d as Ze,C as $e,b as Ge,c as He,A as Xe}from"./ProductServices-Cr3_umUf.js";import{d as M,u as ke}from"./Layout-DRuA_42E.js";import{c as le,g as ce,r as n,h as Ke,S as Qe}from"./index-CU2_kOLs.js";import{C as We}from"./CurrencyServices-D7bllOcu.js";import{L as et}from"./LanguageServices-J1joDgr0.js";import"./httpService-JQLsFEdd.js";import{a as c,n as O}from"./toast-C6v5B_PI.js";var pe={exports:{}};(function(w,x){(function(A,y){w.exports=y()})(le,function(){return function(A,y,h){y.prototype.isBetween=function(P,T,g,C){var R=h(P),p=h(T),B=(C=C||"()")[0]==="(",j=C[1]===")";return(B?this.isAfter(R,g):!this.isBefore(R,g))&&(j?this.isBefore(p,g):!this.isAfter(p,g))||(B?this.isBefore(R,g):!this.isAfter(R,g))&&(j?this.isAfter(p,g):!this.isBefore(p,g))}}})})(pe);var tt=pe.exports;const st=ce(tt);var me={exports:{}};(function(w,x){(function(A,y){w.exports=y()})(le,function(){return function(A,y,h){y.prototype.isToday=function(){var P="YYYY-MM-DD",T=h();return this.format(P)===T.format(P)}}})})(me);var nt=me.exports;const ot=ce(nt),at={type:"object",properties:{_id:{type:"string"},name:{type:"object"},description:{type:"object"},icon:{type:"string"},status:{type:"string"}},required:["name"]},rt={type:"object",properties:{status:{type:"string"},title:{type:"object"},name:{type:"object"},variants:{type:"array"},option:{type:"string"},type:{type:"string"}},required:["name","title"]},it={type:"object",properties:{title:{type:"object"},couponCode:{type:"string"},endTime:{type:"string"},discountPercentage:{type:"number"},minimumAmount:{type:"number"},productType:{type:"string"},logo:{type:"string"},discountType:{type:"object"},status:{type:"string"}},required:["title","couponCode","endTime","status"]},ut={type:"object",properties:{name:{type:"string"},email:{type:"string"}},required:["name","email"]},Ft=w=>{const x=new ze({allErrors:!0}),[A,y]=n.useState(""),[h,P]=n.useState(""),[T,g]=n.useState(""),[C,R]=n.useState(""),[p,B]=n.useState(""),[j,fe]=n.useState(""),[b,K]=n.useState(""),[L,Q]=n.useState(""),[U,W]=n.useState(""),[ge,Se]=n.useState(""),[_,ye]=n.useState(""),[v,Ce]=n.useState(""),[we,he]=n.useState([]),[be,Le]=n.useState([]),[De,Ae]=n.useState([]),[Z,Te]=n.useState(""),[J,Re]=n.useState(""),[V,Oe]=n.useState(""),[$,xe]=n.useState(1),[Pe,ee]=n.useState([]),[je,Fe]=n.useState(""),[Ne,Be]=n.useState(""),[Ue,_e]=n.useState(""),[S,G]=n.useState([]),[Je,q]=n.useState(""),[Ee,Y]=n.useState(!1),[H,Ie]=n.useState(""),[X]=n.useState([]),te=n.useRef(""),se=n.useRef(""),ne=n.useRef(""),oe=n.useRef(""),ae=n.useRef(""),k=n.useRef(""),re=n.useRef(""),ie=n.useRef(""),ue=n.useRef(""),Me=n.useRef(""),de=n.useRef("");M.extend(st),M.extend(ot);const d=Ke(),{lang:E,setIsUpdate:F,setLoading:m}=n.useContext(Qe),{globalSetting:N}=ke(),D=n.useMemo(()=>{const a=new Date;a.setDate(a.getDate()-V);let t=w==null?void 0:w.map(e=>{const r=new Date(e==null?void 0:e.updatedAt).toLocaleString("en-US",{timeZone:N==null?void 0:N.default_time_zone});return{...e,updatedDate:r==="Invalid Date"?"":r}});if(d.pathname==="/dashboard"){const e=t==null?void 0:t.filter(l=>l.status==="Pending");he(e);const r=t==null?void 0:t.filter(l=>l.status==="Processing");Le(r);const s=t==null?void 0:t.filter(l=>l.status==="Delivered");Ae(s);const u=t==null?void 0:t.filter(l=>M(l.createdAt).isToday()),f=u==null?void 0:u.reduce((l,I)=>l+I.total,0);Fe(f);const o=t==null?void 0:t.filter(l=>M(l.createdAt).isBetween(new Date().setDate(new Date().getDate()-30),new Date)),i=o==null?void 0:o.reduce((l,I)=>l+I.total,0);Be(i);const Ye=t==null?void 0:t.reduce((l,I)=>l+I.total,0);_e(Ye)}return A&&(t=t.filter(e=>e.parent===A)),h==="Low"&&(t=t.sort((e,r)=>e.price<r.price&&-1)),h==="High"&&(t=t.sort((e,r)=>e.price>r.price&&-1)),T&&(t=t.filter(e=>{var r;return(r=e==null?void 0:e.title)==null?void 0:r.toLowerCase().includes(T.toLowerCase())})),L&&(t=t.filter(e=>{var r,s,u;return((s=(r=e==null?void 0:e.title[E])==null?void 0:r.toLowerCase())==null?void 0:s.includes(L==null?void 0:L.toLowerCase()))||((u=e==null?void 0:e.attribute)==null?void 0:u.toLowerCase().includes(L==null?void 0:L.toLowerCase()))})),b&&(t=t.filter(e=>{var r,s,u;return((s=(r=e==null?void 0:e.name[E])==null?void 0:r.toLowerCase())==null?void 0:s.includes(b==null?void 0:b.toLowerCase()))||((u=e==null?void 0:e.category)==null?void 0:u.toLowerCase().includes(b==null?void 0:b.toLowerCase()))})),J&&J!="All"&&(console.log(J),t=t.filter(e=>e.role===J)),C&&(t=t.filter(e=>{var r,s,u;return((r=e==null?void 0:e.name[E])==null?void 0:r.toLowerCase().includes(C.toLowerCase()))||((s=e==null?void 0:e.phone)==null?void 0:s.toLowerCase().includes(C.toLowerCase()))||((u=e==null?void 0:e.email)==null?void 0:u.toLowerCase().includes(C.toLowerCase()))})),p&&(t=t==null?void 0:t.filter(e=>{var r,s,u;return((s=(r=e==null?void 0:e.title[E])==null?void 0:r.toLowerCase())==null?void 0:s.includes(p==null?void 0:p.toLowerCase()))||((u=e==null?void 0:e.couponCode)==null?void 0:u.toLowerCase().includes(p==null?void 0:p.toLowerCase()))})),Z&&(t=t.filter(e=>e.status===Z)),j&&(t=t.filter(e=>e.contact.toLowerCase().includes(j.toLowerCase()))),V&&(t=t.filter(e=>M(e.createdAt).isBetween(a,new Date))),U&&(t=t.filter(e=>{var r,s;return((r=e==null?void 0:e.name)==null?void 0:r.toLowerCase().includes(U.toLowerCase()))||((s=e==null?void 0:e.symbol)==null?void 0:s.toLowerCase().includes(U.toLowerCase()))})),H&&(t=t.filter(e=>e==null?void 0:e.name.toLowerCase().includes(H.toLowerCase()))),_&&(t=t.filter(e=>e.name.toLowerCase().includes(_.toLowerCase())||e.symbol.toLowerCase().includes(_.toLowerCase())||e.language_code.toLowerCase().includes(_.toLowerCase()))),v&&(t=t.filter(e=>e.symbol.toLowerCase().includes(v.toLowerCase()))),t},[V,w,d.pathname,A,h,T,L,b,J,C,p,Z,j,U,H,_,v,k,N==null?void 0:N.default_time_zone,E]),z=20,Ve=D==null?void 0:D.length,qe=a=>{xe(a)};return n.useEffect(()=>{ee(D==null?void 0:D.slice(($-1)*z,$*z))},[D,$,z]),{userRef:ne,searchRef:se,couponRef:oe,orderRef:ae,categoryRef:k,attributeRef:re,pending:we,processing:be,delivered:De,todayOrder:je,monthlyOrder:Ne,totalOrder:Ue,setFilter:y,setSortedField:P,setStatus:Te,setRole:Re,time:V,zone:ge,setTime:Oe,taxRef:Me,setZone:Se,filename:Je,countryRef:ie,dataTable:Pe,serviceData:D,country:U,setSearchText:g,setCountry:W,isDisabled:Ee,languageRef:ue,currencyRef:te,shippingRef:de,setSearchUser:R,setDataTable:ee,setCategoryType:K,handleChangePage:qe,totalResults:Ve,resultsPerPage:z,handleOnDrop:a=>{for(let t=0;t<a.length;t++)X.push(a[t].data)},setSearchCoupon:B,setAttributeTitle:Q,handleSelectFile:a=>{var r;a.preventDefault();const t=new FileReader,e=(r=a.target)==null?void 0:r.files[0];e&&e.type==="application/json"?(q(e==null?void 0:e.name),Y(!0),console.log("if"),t.readAsText(e,"UTF-8"),t.onload=s=>{let u=JSON.parse(s.target.result),f=[];d.pathname==="/categories"&&(f=u.map(o=>({_id:o._id,id:o.id,status:o.status,name:o.name,description:o.description,parentName:o.parentName,parentId:o.parentId,icon:o.icon}))),d.pathname==="/attributes"&&(f=u.map(o=>({_id:o._id,status:o.status,title:o.title,name:o.name,variants:o.variants,option:o.option,type:o.type}))),d.pathname==="/coupons"&&(f=u.map(o=>({title:o.title,couponCode:o.couponCode,endTime:o.endTime,discountPercentage:o.discountPercentage,minimumAmount:o.minimumAmount,productType:o.productType,logo:o.logo,discountType:o.discountType,status:o.status}))),d.pathname==="/customers"&&(f=u.map(o=>({name:o.name,email:o.email,password:o.password,phone:o.phone}))),G(f)}):e&&e.type==="text/csv"?(q(e==null?void 0:e.name),Y(!0),console.log("else if"),t.onload=async s=>{const u=s.target.result,f=await Ze().fromString(u);let o=[];d.pathname==="/categories"&&(o=f.map(i=>({_id:i._id,id:i.id,status:i.status,name:JSON.parse(i.name),description:JSON.parse(i.description),parentName:i.parentName,parentId:i.parentId,icon:i.icon}))),d.pathname==="/attributes"&&(o=f.map(i=>({status:i.status,title:JSON.parse(i.title),name:JSON.parse(i.name),variants:JSON.parse(i.variants),option:i.option,type:i.type}))),d.pathname==="/coupons"&&(o=f.map(i=>({title:JSON.parse(i.title),couponCode:i.couponCode,endTime:i.endTime,discountPercentage:i.discountPercentage?JSON.parse(i.discountPercentage):0,minimumAmount:i.minimumAmount?JSON.parse(i.minimumAmount):0,productType:i.productType,logo:i.logo,status:i.status}))),d.pathname==="/customers"&&(o=f.map(i=>({name:i.name,email:i.email,password:i.password,phone:i.phone}))),G(o)},t.readAsText(e)):(q(e==null?void 0:e.name),Y(!0),c("Unsupported file type!"))},handleSubmitUser:a=>{a.preventDefault(),R(ne.current.value)},handleSubmitForAll:a=>{a.preventDefault(),g(se.current.value)},handleSubmitCoupon:a=>{a.preventDefault(),B(oe.current.value)},handleSubmitOrder:a=>{a.preventDefault(),fe(ae.current.value)},handleSubmitCategory:a=>{a.preventDefault(),K(k.current.value)},handleSubmitAttribute:a=>{a.preventDefault(),Q(re.current.value)},handleUploadProducts:()=>{X.length<1?c("Please upload/select csv file first!"):ve.addAllProducts(X).then(a=>{O(a.message)}).catch(a=>c(a.message))},handleSubmitCountry:a=>{a.preventDefault(),W(ie.current.value)},handleSubmitCurrency:a=>{a.preventDefault(),Ce(te.current.value)},handleSubmitShipping:a=>{a.preventDefault(),Ie(de.current.value)},handleSubmitLanguage:a=>{a.preventDefault(),ye(ue.current.value)},handleUploadMultiple:a=>{if(S.length>1){if(d.pathname==="/categories"){m(!0);let t=S.map(s=>x.validate(at,s));const e=s=>s===!0;t.every(e)?$e.addAllCategory(S).then(s=>{m(!1),F(!0),O(s.message)}).catch(s=>{m(!1),c(s?s.response.data.message:s.message)}):c("有効なデータを入力してください！")}if(d.pathname==="/customers"){m(!0);let t=S.map(s=>x.validate(ut,s));const e=s=>s===!0;t.every(e)?Ge.addAllCustomers(S).then(s=>{m(!1),F(!0),O(s.message)}).catch(s=>{m(!1),c(s?s.response.data.message:s.message)}):c("有効なデータを入力してください！")}if(d.pathname==="/coupons"){m(!0);let t=S.map(s=>x.validate(it,s));const e=s=>s===!0;t.every(e)?He.addAllCoupon(S).then(s=>{m(!1),F(!0),O(s.message)}).catch(s=>{m(!1),c(s?s.response.data.message:s.message)}):c("有効なデータを入力してください！")}if(d.pathname==="/attributes"){m(!0);let t=S.map(s=>x.validate(rt,s));const e=s=>s===!0;t.every(e)?Xe.addAllAttributes(S).then(s=>{m(!1),F(!0),O(s.message)}).catch(s=>{m(!1),c(s?s.response.data.message:s.message)}):c("有効なデータを入力してください！")}d.pathname==="/languages"&&et.addAllLanguage(S).then(t=>{F(!0),O(t.message)}).catch(t=>c(t?t.response.data.message:t.message)),d.pathname==="/currencies"&&We.addAllCurrency(S).then(t=>{F(!0),O(t.message)}).catch(t=>c(t?t.response.data.message:t.message))}else c("Please select a valid .JSON/.CSV/.XLS file first!")},handleRemoveSelectFile:a=>{q(""),G([]),setTimeout(()=>Y(!1),1e3)}}};export{ot as a,st as i,Ft as u};
