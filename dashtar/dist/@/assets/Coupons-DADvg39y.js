import{r as h,S as H,j as e,v as c,d as l,f as Q}from"./index-CU2_kOLs.js";import{u as Y,d as _,l as W,e as X,f as ee,g as se}from"./Layout-DRuA_42E.js";import{c as E}from"./ProductServices-Cr3_umUf.js";import{u as le}from"./useAsync-B8u39IQg.js";import{T as V,D as ae,u as $,M as K}from"./DrawerButton-0gO4Hlg-.js";import{u as te}from"./useFilter-BqmGAN4t.js";import{P as re}from"./PageTitle-yWCDsDLT.js";import{D as Z,E as ie}from"./EditDeleteButton-on8Y3x1g.js";import{C as G,S as ne,B as de}from"./BulkActionDrawer-B3aeXq8p.js";import{u as me,E as B}from"./index.esm-DIMQlkj7.js";import{I as L}from"./InputArea-BIZuEPJq.js";import{I as O}from"./InputValue-b7VUcf_U.js";import{L as k}from"./LabelArea-CAL50iuc.js";import{U as ce}from"./Uploader-kbPRPoOf.js";import{a as q,n as z}from"./toast-C6v5B_PI.js";import{S as oe}from"./SwitchToggle-BnYDP_80.js";import{a as xe}from"./index.prod-C20Q0sNj.js";import{T as ge}from"./TableLoading-BZuy6X-P.js";import{N as pe}from"./NotFound-CqWvhjgB.js";import{U as ue}from"./UploadMany-MqzwiuKH.js";import{A as he}from"./AnimatedContent-BRwehZiw.js";import"./iconBase-CMZs39VK.js";import"./useDispatch-DNOf3xOQ.js";import"./httpService-JQLsFEdd.js";import"./index-C5uRs8v0.js";import"./spinner-CkndCogW.js";import"./CurrencyServices-D7bllOcu.js";import"./LanguageServices-J1joDgr0.js";import"./AdminServices-D_Y1VEvB.js";import"./Tooltip-CHrqK3eg.js";import"./index-7mr9-FxN.js";import"./ParentCategory-DKrqctpp.js";import"./tslib.es6-BgFQhbLt.js";import"./exportFromJSON-fDIoOtpr.js";const je=a=>{const{isDrawerOpen:n,closeDrawer:j,setIsUpdate:d,lang:m}=h.useContext(H),[w,b]=h.useState(""),[f,y]=h.useState(m),[C,g]=h.useState({}),[p,N]=h.useState(!1),[v,s]=h.useState(!1),[u,o]=h.useState(!1),{currency:S}=Y(),{register:A,handleSubmit:F,setValue:r,clearErrors:D,formState:{errors:U}}=me(),M=i=>{for(const T in i)i[T].trim()===""&&delete i[T];return i},I=async i=>{var T,P;try{o(!0);const x={title:M({[f]:i.title}),couponCode:i.couponCode,endTime:i.endTime,minimumAmount:i.minimumAmount,logo:w,lang:f,status:p?"show":"hide",discountType:{type:v?"percentage":"fixed",value:i.discountPercentage},productType:i.productType};if(a){const t=await E.updateCoupon(a,x);d(!0),o(!1),z(t.message),j()}else{const t=await E.addCoupon(x);d(!0),o(!1),z(t.message),j()}}catch(x){q(((P=(T=x==null?void 0:x.response)==null?void 0:T.data)==null?void 0:P.message)||(x==null?void 0:x.message)),o(!1),j()}},R=i=>{y(i),Object.keys(C).length>0&&r("title",C.title[i||"en"])};return h.useEffect(()=>{if(!n){g({}),r("title"),r("productType"),r("couponCode"),r("endTime"),r("discountPercentage"),r("minimumAmount"),b(""),D("title"),D("productType"),D("couponCode"),D("endTime"),D("discountPercentage"),D("minimumAmount"),y(m),r("language",f);return}a&&(async()=>{var i,T,P,x;try{const t=await E.getCouponById(a);t&&(g(t),r("title",t.title[f||"en"]),r("productType",t.productType),r("couponCode",t.couponCode),r("endTime",_(t.endTime).format("YYYY-MM-DD HH:mm")),r("discountPercentage",(i=t.discountType)==null?void 0:i.value),r("minimumAmount",t.minimumAmount),N(t.status==="show"),s(((T=t.discountType)==null?void 0:T.type)==="percentage"),b(t.logo))}catch(t){q(((x=(P=t==null?void 0:t.response)==null?void 0:P.data)==null?void 0:x.message)||(t==null?void 0:t.message))}})()},[a,r,n,D,f,m]),{register:A,handleSubmit:F,onSubmit:I,errors:U,setImageUrl:b,imageUrl:w,published:p,setPublished:N,currency:S,discountType:v,isSubmitting:u,setDiscountType:s,handleSelectLanguage:R}},be=({title:a,handleProcess:n,processOption:j,product:d,handleIsCombination:m})=>e.jsx(e.Fragment,{children:e.jsx("div",{className:`${d?"mb-3 flex flex-wrap justify-end items-center mr-8":"mb-3"}`,children:e.jsxs("div",{className:"flex flex-wrap items-center",children:[d?e.jsx("label",{className:"block text-base font-normal text-orange-500 dark:text-orange-400 mx-4",children:"Does this product have variants?"}):e.jsx("label",{className:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-1",children:a}),e.jsx(xe,{onChange:d?m:n,checked:j,className:"react-switch",uncheckedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingRight:45,paddingTop:1,width:"max-content"},children:"固定"}),width:125,height:33,handleDiameter:28,offColor:"#E53E3E",onColor:"#2F855A",checkedIcon:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",fontSize:14,color:"white",paddingLeft:50,width:"max-content",paddingTop:1},children:"割合"})})]})})}),J=({id:a})=>{const{register:n,handleSubmit:j,onSubmit:d,errors:m,setImageUrl:w,imageUrl:b,published:f,setPublished:y,currency:C,discountType:g,setDiscountType:p,isSubmitting:N,handleSelectLanguage:v}=je(a);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative  p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 ",children:a?e.jsx(V,{register:n,handleSelectLanguage:v,title:c("UpdateCoupon"),description:c("UpdateCouponDescription")}):e.jsx(V,{register:n,handleSelectLanguage:v,title:c("AddCoupon"),description:c("AddCouponDescription")})}),e.jsx(W.Scrollbars,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:j(d),children:[e.jsxs("div",{className:"px-6 pt-8 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("CouponBannerImage")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ce,{imageUrl:b,setImageUrl:w,folder:"coupon"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("CampaignName")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(L,{required:!0,register:n,label:"Coupon title",name:"title",type:"text",placeholder:c("CampaignName")}),e.jsx(B,{errorName:m.title})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("CampaignCode")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(L,{required:!0,register:n,label:"Coupon Code",name:"couponCode",type:"text",placeholder:c("CampaignCode")}),e.jsx(B,{errorName:m.couponCode})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("CouponValidityTime")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(l.Input,{...n("endTime",{required:"クーポンの有効期限終了時間"}),label:"クーポンの有効期限終了時間",name:"endTime",type:"datetime-local",placeholder:c("CouponValidityTime")}),e.jsx(B,{errorName:m.endTime})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("DiscountType")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(be,{handleProcess:p,processOption:g}),e.jsx(B,{errorName:m.discountType})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("Discount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,required:!0,register:n,maxValue:g?99:1e3,minValue:1,label:"Discount",name:"discountPercentage",type:"number",placeholder:g?"Percentage":"Fixed Amount",currency:g?"%":C}),e.jsx(B,{errorName:m.discountPercentage})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("MinimumAmount")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(O,{product:!0,required:!0,register:n,maxValue:2e5,minValue:100,label:"Minimum Amount",name:"minimumAmount",type:"number",placeholder:c("MinimumAmountPlasholder"),currency:C}),e.jsx(B,{errorName:m.minimumAmount})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(k,{label:c("Published")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(oe,{handleProcess:y,processOption:f}),e.jsx(B,{errorName:m.productType})]})]})]}),e.jsx(ae,{id:a,title:"Coupon",isSubmitting:N})]})})]})},fe=({isCheck:a,coupons:n,setIsCheck:j})=>{const[d,m]=h.useState([]),{title:w,serviceId:b,handleModalOpen:f,handleUpdate:y}=$(),{currency:C,showDateFormat:g,globalSetting:p,showingTranslateValue:N}=Y(),v=s=>{const{id:u,checked:o}=s.target;j([...a,u]),o||j(a.filter(S=>S!==u))};return h.useEffect(()=>{const s=n==null?void 0:n.map(u=>{const o=new Date(u==null?void 0:u.updatedAt).toLocaleString("en-US",{timeZone:p==null?void 0:p.default_time_zone});return{...u,updatedDate:o}});m(s)},[n,p==null?void 0:p.default_time_zone]),e.jsxs(e.Fragment,{children:[a.length<1&&e.jsx(Z,{id:b,title:w}),a.length<2&&e.jsx(K,{children:e.jsx(J,{id:b})}),e.jsx(l.TableBody,{children:d==null?void 0:d.map((s,u)=>{var o,S,A,F,r;return e.jsxs(l.TableRow,{children:[e.jsx(l.TableCell,{children:e.jsx(G,{type:"checkbox",name:(o=s==null?void 0:s.title)==null?void 0:o.en,id:s._id,handleClick:v,isChecked:a==null?void 0:a.includes(s._id)})}),e.jsxs(l.TableCell,{children:[e.jsxs("div",{className:"flex items-center",children:[s!=null&&s.logo?e.jsx(l.Avatar,{className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none",src:s==null?void 0:s.logo,alt:"product"}):e.jsx(l.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm",children:N(s==null?void 0:s.title)})," "]})]})," "]}),e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm",children:[" ",s.couponCode]})," "]}),(S=s==null?void 0:s.discountType)!=null&&S.type?e.jsxs(l.TableCell,{children:[" ",e.jsxs("span",{className:"text-sm font-semibold",children:[" ",((A=s==null?void 0:s.discountType)==null?void 0:A.type)==="percentage"?`${(F=s==null?void 0:s.discountType)==null?void 0:F.value}%`:`${C}${(r=s==null?void 0:s.discountType)==null?void 0:r.value}`]})," "]}):e.jsxs(l.TableCell,{children:[" ",e.jsx("span",{className:"text-sm font-semibold",children:" "})," "]}),e.jsx(l.TableCell,{className:"text-center",children:e.jsx(ne,{id:s._id,status:s.status})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.startTime)})}),e.jsx(l.TableCell,{children:e.jsx("span",{className:"text-sm",children:g(s.endTime)})}),e.jsx(l.TableCell,{className:"align-middle ",children:_().isAfter(_(s.endTime))?e.jsx(l.Badge,{type:"danger",children:"期限切れ"}):e.jsx(l.Badge,{type:"success",children:"アクティブ"})}),e.jsx(l.TableCell,{children:e.jsx(ie,{id:s==null?void 0:s._id,isCheck:a,handleUpdate:y,handleModalOpen:f,title:N(s==null?void 0:s.title)})})]},u+1)})})]})},es=()=>{const{t:a}=Q(),{toggleDrawer:n,lang:j}=h.useContext(H),{data:d,loading:m,error:w}=le(E.getAllCoupons),[b,f]=h.useState(!1),[y,C]=h.useState([]),{allId:g,serviceId:p,handleDeleteMany:N,handleUpdateMany:v}=$(),{filename:s,isDisabled:u,couponRef:o,dataTable:S,serviceData:A,totalResults:F,resultsPerPage:r,handleChangePage:D,handleSelectFile:U,setSearchCoupon:M,handleSubmitCoupon:I,handleUploadMultiple:R,handleRemoveSelectFile:i}=te(d),T=()=>{f(!b),C(d==null?void 0:d.map(x=>x._id)),b&&C([])},P=()=>{M(""),o.current.value=""};return e.jsxs(e.Fragment,{children:[e.jsx(re,{children:a("CouponspageTitle")}),e.jsx(Z,{ids:g,setIsCheck:C,title:"選択されたクーポン"}),e.jsx(de,{ids:g,title:"クーポン"}),e.jsx(K,{children:e.jsx(J,{id:p})}),e.jsxs(he,{children:[e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:I,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6  xl:flex",children:[e.jsx("div",{className:"flex justify-start xl:w-1/2  md:w-full",children:e.jsx(ue,{title:"クーポン",exportData:d,filename:s,isDisabled:u,handleSelectFile:U,handleUploadMultiple:R,handleRemoveSelectFile:i})}),e.jsxs("div",{className:"lg:flex  md:flex xl:justify-end xl:w-1/2  md:w-full md:justify-start flex-grow-0",children:[e.jsx("div",{className:"w-full md:w-40 lg:w-40 xl:w-40 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:y.length<1,onClick:()=>v(y),className:"w-full rounded-md h-12 btn-gray text-gray-600",children:[e.jsx("span",{className:"mr-2",children:e.jsx(X,{})}),a("BulkAction")]})}),e.jsx("div",{className:"w-full md:w-32 lg:w-32 xl:w-32 mr-3 mb-3 lg:mb-0",children:e.jsxs(l.Button,{disabled:y.length<1,onClick:()=>N(y),className:"w-full rounded-md h-12 bg-red-500 btn-red",children:[e.jsx("span",{className:"mr-2",children:e.jsx(ee,{})}),a("Delete")]})}),e.jsx("div",{className:"w-full md:w-48 lg:w-48 xl:w-48",children:e.jsxs(l.Button,{onClick:n,className:"w-full rounded-md h-12",children:[e.jsx("span",{className:"mr-2",children:e.jsx(se,{})}),a("AddCouponsBtn")]})})]})]})})}),e.jsx(l.Card,{className:"min-w-0 shadow-xs overflow-hidden bg-white dark:bg-gray-800 mb-5",children:e.jsx(l.CardBody,{children:e.jsxs("form",{onSubmit:I,className:"py-3 grid gap-4 lg:gap-6 xl:gap-6 md:flex xl:flex",children:[e.jsx("div",{className:"flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:e.jsx(l.Input,{ref:o,type:"search",placeholder:a("SearchCoupon")})}),e.jsxs("div",{className:"flex items-center gap-2 flex-grow-0 md:flex-grow lg:flex-grow xl:flex-grow",children:[e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{type:"submit",className:"h-12 w-full bg-emerald-700",children:a("Filter")})}),e.jsx("div",{className:"w-full mx-1",children:e.jsx(l.Button,{layout:"outline",onClick:P,type:"reset",className:"px-4 md:py-1 py-2 h-12 text-sm dark:bg-gray-700",children:e.jsx("span",{className:"text-black dark:text-gray-200",children:a("Reset")})})})]})]})})})]}),m?e.jsx(ge,{row:12,col:8,width:140,height:20}):w?e.jsx("span",{className:"text-center mx-auto text-red-500",children:w}):(A==null?void 0:A.length)!==0?e.jsxs(l.TableContainer,{className:"mb-8",children:[e.jsxs(l.Table,{children:[e.jsx(l.TableHeader,{children:e.jsxs("tr",{children:[e.jsx(l.TableCell,{children:e.jsx(G,{type:"checkbox",name:"selectAll",id:"selectAll",handleClick:T,isChecked:b})}),e.jsx(l.TableCell,{children:a("CoupTblCampaignsName")}),e.jsx(l.TableCell,{children:a("CoupTblCode")}),e.jsx(l.TableCell,{children:a("Discount")}),e.jsx(l.TableCell,{className:"text-center",children:a("catPublishedTbl")}),e.jsx(l.TableCell,{children:a("CoupTblStartDate")}),e.jsx(l.TableCell,{children:a("CoupTblEndDate")}),e.jsx(l.TableCell,{children:a("CoupTblStatus")}),e.jsx(l.TableCell,{className:"text-right",children:a("CoupTblActions")})]})}),e.jsx(fe,{lang:j,isCheck:y,coupons:S,setIsCheck:C})]}),e.jsx(l.TableFooter,{children:e.jsx(l.Pagination,{totalResults:F,resultsPerPage:r,onChange:D,label:"テーブルナビゲーション"})})]}):e.jsx(pe,{title:"申し訳ありません。現在、クーポンはありません。"})]})};export{es as default};
